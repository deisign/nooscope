<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nooscope Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Nooscope Dashboard</h1>

        <!-- Reddit Trends -->
        <div class="mt-4">
            <h2>Reddit Trends</h2>
            <ul id="reddit-results" class="list-group"></ul>
        </div>

        <!-- News Headlines -->
        <div class="mt-4">
            <h2>Top News Headlines</h2>
            <ul id="news-results" class="list-group"></ul>
        </div>

        <!-- RSS Feeds -->
        <div class="mt-4">
            <h2>RSS Feeds</h2>
            <ul id="rss-results" class="list-group"></ul>
        </div>

        <!-- Google Trends -->
        <div class="mt-4">
            <h2>Google Trends</h2>
            <ul id="google-results" class="list-group"></ul>
        </div>
    </div>

    <script>
        async function fetchData(url, elementId) {
            const results = document.getElementById(elementId);
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                results.innerHTML = ''; // Clear previous results

                // Check if data is empty or contains error
                if (data.error) {
                    results.innerHTML = `<li class="text-danger">Error: ${data.error}</li>`;
                    console.error(`Error fetching ${url}:`, data.error);
                    return;
                }
                if (data.length === 0 || Object.keys(data).length === 0) {
                    results.innerHTML = `<li class="text-muted">No data available</li>`;
                    return;
                }

                // Populate the list with data
                if (Array.isArray(data)) {
                    data.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'list-group-item';
                        li.innerHTML = `<a href="${item.url || item.link}" target="_blank">${item.title}</a>`;
                        results.appendChild(li);
                    });
                } else {
                    for (const [key, value] of Object.entries(data)) {
                        value.forEach(item => {
                            const li = document.createElement('li');
                            li.className = 'list-group-item';
                            li.innerHTML = `<a href="${item.link}" target="_blank">${item.title} (${key})</a>`;
                            results.appendChild(li);
                        });
                    }
                }
            } catch (error) {
                results.innerHTML = `<li class="text-danger">Error fetching data: ${error.message}</li>`;
                console.error(`Error fetching ${url}:`, error);
            }
        }

        // Automatically fetch data and populate sections
        fetchData('/reddit-trends', 'reddit-results');
        fetchData('/news-headlines', 'news-results');
        fetchData('/rss-feed', 'rss-results');
        fetchData('/google-trends', 'google-results');
    </script>
</body>
</html>
